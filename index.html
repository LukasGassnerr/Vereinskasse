<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Vereinskasse ‚Äì Sportunion St. Georgen/Leys</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { box-sizing: border-box; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }

    body {
      margin:0;
      padding:10px;
      /* Blaue Hintergrund-Stimmung */
      background: radial-gradient(circle at top, #e6f0ff 0, #f5f7fb 45%, #f5f7fb 100%);
    }

    /* Header mit Wappen und Vereinsfarben (Blau) */
    .app-header {
      display:flex;
      align-items:center;
      gap:10px;
      background: linear-gradient(135deg, #003b80, #0066c7);
      color:white;
      padding:10px;
      border-radius:14px;
      box-shadow:0 3px 8px rgba(0,0,0,0.18);
      margin-bottom:10px;
    }
    .app-logo {
      width:52px;
      height:52px;
      border-radius:50%;
      background:white;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      flex-shrink:0;
      box-shadow:0 0 0 2px rgba(0,0,0,0.1);
    }
    .app-logo img {
      width:100%;
      height:100%;
      object-fit:contain;
    }
    .app-title-main {
      font-size:1.1rem;
      font-weight:700;
      line-height:1.2;
    }
    .app-title-sub {
      font-size:0.8rem;
      opacity:0.9;
    }

    h2 { font-size:1.1rem; margin:12px 0 6px; }
    h3 { font-size:0.95rem; margin:6px 0; }

    .card {
      background:white;
      border-radius:10px;
      padding:10px;
      margin-bottom:10px;
      box-shadow:0 2px 4px rgba(0,0,0,0.06);
      border-top: 3px solid #003b80;
    }

    label { font-size:0.85rem; display:block; margin-bottom:3px; }

    input[type="text"], input[type="number"], select {
      width:100%;
      padding:8px;
      margin-bottom:6px;
      border-radius:6px;
      border:1px solid #c4d6f3;
      font-size:1rem;
      background:#f5f8ff;
    }

    button {
      padding:8px 10px;
      border-radius:999px;
      border:none;
      font-size:0.9rem;
      cursor:pointer;
      margin:2px 0;
      transition: transform 0.05s ease, box-shadow 0.05s ease, opacity 0.1s;
    }
    button:active {
      transform:scale(0.97);
      box-shadow:0 1px 2px rgba(0,0,0,0.2) inset;
      opacity:0.85;
    }
    button.primary {
      background:#0050b8;
      color:white;
      box-shadow:0 2px 4px rgba(0,80,184,0.35);
    }
    button.secondary {
      background:#e0ebff;
      color:#123055;
    }
    button.small { font-size:0.8rem; padding:6px 10px; }

    .button-row {
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      margin-top:4px;
    }

    .item-list {
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      max-height:260px;
      overflow-y:auto;
    }
    .item-btn {
      flex:1 0 calc(50% - 6px);
      background:#ffffff;
      border:1px solid #d1ddf5;
      border-radius:10px;
      padding:8px;
      text-align:center;
      font-size:0.9rem;
      position:relative;
    }
    .item-btn:hover { background:#f1f5ff; }
    .item-name { font-weight:600; display:block; }
    .item-price { font-size:0.8rem; color:#555; }
    .edit-icon {
      position:absolute;
      top:5px;
      right:5px;
      font-size:16px;
      cursor:pointer;
    }

    .hidden { display:none !important; }

    .cart-table { width:100%; border-collapse:collapse; font-size:0.9rem; }
    .cart-table th, .cart-table td { padding:4px; }
    .cart-table th {
      border-bottom:1px solid #d0dbf3;
      text-align:left;
      background:#e4ecff;
    }
    .cart-table td:last-child,
    .cart-table th:last-child { text-align:right; }

    .cart-actions { display:flex; gap:6px; margin-top:8px; }
    .cart-actions button { flex:1; }

    .summary { font-size:0.95rem; }
    .summary strong { font-size:1.1rem; }

    .small { font-size:0.8rem; color:#555; }

    .badge {
      display:inline-block;
      padding:2px 6px;
      border-radius:999px;
      font-size:0.75rem;
      background:#e4ecff;
      color:#123055;
      margin-left:4px;
    }

    .log-list { max-height:150px; overflow-y:auto; font-size:0.85rem; }
    .log-entry { border-bottom:1px solid #eee; padding:3px 0; }
    .log-time { color:#666; font-size:0.8rem; }

    .category-block { margin-bottom:8px; }

    .category-header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:4px;
    }
    .category-header h3 { margin:0; }
    .category-pill {
      font-size:0.75rem;
      padding:2px 8px;
      border-radius:999px;
      background:#e0ebff;
      color:#123055;
    }
  </style>
</head>
<body>
  <!-- Header mit Wappen -->
  <header class="app-header">
    <div class="app-logo">
      <!-- Datei muss im Repo als wappen.png liegen -->
      <img src="wappen.png" alt="Vereinswappen">
    </div>
    <div>
      <div class="app-title-main">Vereinskasse</div>
      <div class="app-title-sub">Sportunion St. Georgen an der Leys ‚Äì Sektion Tennis</div>
    </div>
  </header>

  <div class="card">
    <div class="summary">
      <div>Datum: <span id="dateText"></span></div>
      <div>Heutiger Tagesumsatz: <strong id="dayTotal">0,00 ‚Ç¨</strong></div>
      <div class="small">Dieses System ist eine einfache Hilfe und keine gesetzliche Registrierkasse.</div>
    </div>
    <div class="button-row">
      <button class="secondary small" id="adminLoginBtn">üîê Admin Login</button>
      <button class="secondary small hidden" id="adminLogoutBtn">üö™ Logout</button>
    </div>
  </div>

  <!-- Admin-Bereich -->
  <div class="card hidden" id="adminPanel">
    <h2>Artikel anlegen (Admin)</h2>
    <label for="itemName">Name</label>
    <input type="text" id="itemName" placeholder="z.B. Bier, Brandflecken">
    <label for="itemPrice">Preis in ‚Ç¨</label>
    <input type="number" id="itemPrice" step="0.01" min="0" placeholder="z.B. 2.50">
    <label for="itemCategory">Kategorie</label>
    <select id="itemCategory">
      <option value="Trinken">Trinken</option>
      <option value="Essen">Essen</option>
    </select>
    <button class="primary" style="width:100%;" id="addItemBtn">Artikel speichern</button>

    <div class="button-row">
      <button class="secondary small" id="exportItemsBtn">Artikel exportieren (Admin)</button>
      <button class="secondary small" id="profileCodeBtn">Profil-Code erzeugen</button>
    </div>
    <div class="small">
      Artikel werden im Browser dieses Ger√§ts gespeichert.<br>
      √úber Export kannst du die Liste als JSON teilen.<br>
      √úber ‚ÄûProfil-Code erzeugen‚Äú bekommst du Code f√ºr PROFILES.
    </div>
  </div>

  <!-- Artikel-Auswahl -->
  <div class="card">
    <h2>Artikel ausw√§hlen</h2>

    <div class="category-block">
      <div class="category-header">
        <h3>ü•§ Trinken</h3>
        <span class="category-pill">Getr√§nke</span>
      </div>
      <div class="item-list" id="itemListDrinks"></div>
    </div>

    <div class="category-block">
      <div class="category-header">
        <h3>üçΩÔ∏è Essen</h3>
        <span class="category-pill">Snacks & Speisen</span>
      </div>
      <div class="item-list" id="itemListFood"></div>
    </div>

    <div class="button-row">
      <button class="secondary small" id="importItemsBtn">Artikel importieren</button>
    </div>
    <div class="small">
      Tippen = in Warenkorb.<br>
      ‚öôÔ∏è = bearbeiten/l√∂schen (nur Admin).<br>
      Beim Import kannst du ENTWEDER den langen Text einf√ºgen<br>
      ODER z.B. <strong>stockschiessen</strong> als Profilnamen.
    </div>
  </div>

  <!-- Warenkorb -->
  <div class="card">
    <h2>Warenkorb</h2>
    <table class="cart-table">
      <thead>
        <tr>
          <th>Artikel</th>
          <th>Menge</th>
          <th>Summe</th>
        </tr>
      </thead>
      <tbody id="cartBody">
        <tr><td colspan="3" class="small">Noch keine Artikel im Warenkorb.</td></tr>
      </tbody>
    </table>
    <div style="margin-top:6px;">
      <strong>Gesamt: <span id="cartTotal">0,00 ‚Ç¨</span></strong>
    </div>
    <div class="cart-actions">
      <button class="secondary" id="clearCartBtn">Warenkorb leeren</button>
      <button class="primary" id="bookSaleBtn">Verkauf buchen</button>
    </div>
  </div>

  <!-- Buchungen -->
  <div class="card">
    <h2>Heutige Buchungen</h2>
    <div class="log-list" id="logList">
      <div class="small">Noch keine Buchungen heute.</div>
    </div>
  </div>

<script>
  const PIN = "1111";
  const STORAGE_ITEMS_KEY = "kasse_items_v1";
  const STORAGE_SALES_KEY_PREFIX = "kasse_sales_";
  const CATEGORIES = ["Trinken", "Essen"];

  // Profile (kannst du erweitern!)
  const PROFILES = {
    "stockschiessen": [
      {"id":1,"name":"Bier","price":3.5,"category":"Trinken"},
      {"id":2,"name":"Spritzer","price":2.9,"category":"Trinken"},
      {"id":8,"name":"Holler Spritzer","price":2.9,"category":"Trinken"},
      {"id":9,"name":"Limo","price":2.6,"category":"Trinken"},
      {"id":10,"name":"Tee mit","price":2.8,"category":"Trinken"},
      {"id":11,"name":"Tee ohne","price":1.7,"category":"Trinken"},
      {"id":12,"name":"Kaffee","price":2.5,"category":"Trinken"},
      {"id":13,"name":"Gl√ºhwein","price":4,"category":"Trinken"},
      {"id":14,"name":"Eieraufschlag","price":2.8,"category":"Trinken"},
      {"id":15,"name":"Kinderpunsch","price":2.5,"category":"Trinken"},
      {"id":16,"name":"Brandflecken","price":3.9,"category":"Essen"},
      {"id":17,"name":"Speckbrot","price":3,"category":"Essen"},
      {"id":18,"name":"Bratlfettenbrot","price":2.5,"category":"Essen"},
      {"id":19,"name":"Zwiebelschmalzbrot","price":2.5,"category":"Essen"},
      {"id":20,"name":"Kekse","price":2.8,"category":"Essen"}
    ]
    
  };
  // auch mit √ü erlauben
  PROFILES["stockschie√üen"] = PROFILES["stockschiessen"];

  let isAdmin = false;
  let items = loadItems();
  let cart = {};
  let salesToday = loadSalesForToday();

  function formatEuro(value) {
    return value.toFixed(2).replace('.', ',') + " ‚Ç¨";
  }
  function getTodayKey() {
    return new Date().toISOString().slice(0,10);
  }
  function normalizeItem(item) {
    if (!item.category || !CATEGORIES.includes(item.category)) {
      item.category = "Trinken";
    }
    return item;
  }

  function loadItems() {
    const raw = localStorage.getItem(STORAGE_ITEMS_KEY);
    let list;
    if (!raw) {
      list = [];
    } else {
      try { list = JSON.parse(raw); } catch { list = []; }
    }
    return list.map(normalizeItem);
  }
  function saveItems(items) {
    localStorage.setItem(STORAGE_ITEMS_KEY, JSON.stringify(items));
  }

  function loadSalesForToday() {
    const key = STORAGE_SALES_KEY_PREFIX + getTodayKey();
    const raw = localStorage.getItem(key);
    if (!raw) return { total: 0, entries: [] };
    try { return JSON.parse(raw); } catch { return { total: 0, entries: [] }; }
  }
  function saveSalesForToday(data) {
    const key = STORAGE_SALES_KEY_PREFIX + getTodayKey();
    localStorage.setItem(key, JSON.stringify(data));
  }

  function updateAdminUI() {
    const adminPanel = document.getElementById("adminPanel");
    const loginBtn = document.getElementById("adminLoginBtn");
    const logoutBtn = document.getElementById("adminLogoutBtn");

    if (isAdmin) {
      adminPanel.classList.remove("hidden");
      logoutBtn.classList.remove("hidden");
      loginBtn.classList.add("hidden");
    } else {
      adminPanel.classList.add("hidden");
      logoutBtn.classList.add("hidden");
      loginBtn.classList.remove("hidden");
    }

    document.querySelectorAll(".edit-icon").forEach(icon => {
      icon.style.display = isAdmin ? "inline" : "none";
    });
  }

  document.getElementById("adminLoginBtn").addEventListener("click", () => {
    const entered = prompt("Admin-PIN eingeben:");
    if (entered === PIN) {
      isAdmin = true;
      updateAdminUI();
    } else {
      alert("Falscher PIN.");
    }
  });
  document.getElementById("adminLogoutBtn").addEventListener("click", () => {
    isAdmin = false;
    updateAdminUI();
  });

  function renderDate() {
    const dateText = document.getElementById("dateText");
    const today = new Date();
    const options = { weekday:"short", day:"2-digit", month:"2-digit", year:"numeric" };
    dateText.textContent = today.toLocaleDateString("de-AT", options);
  }
  function renderDayTotal() {
    document.getElementById("dayTotal").textContent = formatEuro(salesToday.total);
  }
  function renderLog() {
    const container = document.getElementById("logList");
    container.innerHTML = "";
    if (!salesToday.entries || salesToday.entries.length === 0) {
      container.innerHTML = '<div class="small">Noch keine Buchungen heute.</div>';
      return;
    }
    salesToday.entries.slice().reverse().forEach(entry => {
      const div = document.createElement("div");
      div.className = "log-entry";
      const time = new Date(entry.time);
      const timeStr = time.toLocaleTimeString("de-AT",{hour:"2-digit",minute:"2-digit"});
      div.innerHTML = `
        <div><strong>${formatEuro(entry.total)}</strong> <span class="badge">${entry.items.length} Pos.</span></div>
        <div class="log-time">${timeStr}</div>
      `;
      container.appendChild(div);
    });
  }

  function createItemElement(item) {
    const div = document.createElement("div");
    div.className = "item-btn";
    div.innerHTML = `
      <span class="item-name">${item.name}</span>
      <span class="item-price">${formatEuro(item.price)}</span>
      <span class="edit-icon" style="display:${isAdmin ? 'inline' : 'none'};">‚öôÔ∏è</span>
    `;
    div.addEventListener("click", (e) => {
      if (e.target.classList.contains("edit-icon")) {
        if (isAdmin) editOrDeleteItem(item);
      } else {
        addToCart(item);
      }
    });
    return div;
  }

  function renderItems() {
    const drinksContainer = document.getElementById("itemListDrinks");
    const foodContainer   = document.getElementById("itemListFood");
    drinksContainer.innerHTML = "";
    foodContainer.innerHTML   = "";

    if (items.length === 0) {
      drinksContainer.innerHTML = '<div class="small">Noch keine Artikel angelegt oder importiert.</div>';
      foodContainer.innerHTML   = '';
      return;
    }

    const drinks = items.filter(it => it.category === "Trinken");
    const food   = items.filter(it => it.category === "Essen");

    if (drinks.length === 0) {
      drinksContainer.innerHTML = '<div class="small">Keine Getr√§nke angelegt.</div>';
    } else {
      drinks.forEach(item => drinksContainer.appendChild(createItemElement(item)));
    }

    if (food.length === 0) {
      foodContainer.innerHTML = '<div class="small">Keine Speisen angelegt.</div>';
    } else {
      food.forEach(item => foodContainer.appendChild(createItemElement(item)));
    }
  }

  function addNewItem() {
    if (!isAdmin) {
      alert("Artikel √§ndern nur im Admin-Modus (PIN).");
      return;
    }
    const nameInput = document.getElementById("itemName");
    const priceInput = document.getElementById("itemPrice");
    const categorySelect = document.getElementById("itemCategory");

    const name = nameInput.value.trim();
    const price = parseFloat((priceInput.value || "").replace(",", "."));
    const category = categorySelect.value;

    if (!name) return alert("Bitte einen Artikelnamen eingeben.");
    if (isNaN(price) || price < 0) return alert("Bitte einen g√ºltigen Preis eingeben.");
    if (!CATEGORIES.includes(category)) return alert("Bitte eine g√ºltige Kategorie w√§hlen.");

    const maxId = items.reduce((m,it)=>Math.max(m,it.id||0),0);
    const newItem = { id:maxId+1, name, price, category };
    items.push(newItem);
    saveItems(items);
    nameInput.value = "";
    priceInput.value = "";
    categorySelect.value = "Trinken";
    renderItems();
    updateAdminUI();
  }

  function editOrDeleteItem(item) {
    if (!isAdmin) {
      alert("Artikel bearbeiten nur im Admin-Modus (PIN).");
      return;
    }
    const newName = prompt("Neuer Name (leer lassen zum L√∂schen):", item.name);
    if (newName === null) return;

    if (newName.trim() === "") {
      if (confirm("Diesen Artikel wirklich l√∂schen?")) {
        items = items.filter(it => it.id !== item.id);
        saveItems(items);
        if (cart[item.id]) { delete cart[item.id]; renderCart(); }
        renderItems();
        updateAdminUI();
      }
      return;
    }

    const newPrice = prompt("Neuer Preis (‚Ç¨):", item.price.toString().replace(".", ","));
    if (newPrice === null) return;
    const priceValue = parseFloat(newPrice.replace(",", "."));
    if (isNaN(priceValue) || priceValue < 0) {
      alert("Ung√ºltiger Preis, keine √Ñnderung.");
      return;
    }

    const newCategory = prompt("Kategorie (Trinken/Essen):", item.category || "Trinken");
    const catClean = (newCategory || "").trim();
    if (!CATEGORIES.includes(catClean)) {
      alert("Ung√ºltige Kategorie, es bleibt bei: " + item.category);
    } else {
      item.category = catClean;
    }

    item.name = newName.trim();
    item.price = priceValue;
    saveItems(items);
    renderItems();
    renderCart();
    updateAdminUI();
  }

  function renderCart() {
    const tbody = document.getElementById("cartBody");
    const totalSpan = document.getElementById("cartTotal");
    const entries = Object.values(cart);

    if (entries.length === 0) {
      tbody.innerHTML = '<tr><td colspan="3" class="small">Noch keine Artikel im Warenkorb.</td></tr>';
      totalSpan.textContent = "0,00 ‚Ç¨";
      return;
    }

    tbody.innerHTML = "";
    let total = 0;

    entries.forEach(entry => {
      const lineTotal = entry.item.price * entry.qty;
      total += lineTotal;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${entry.item.name}</td>
        <td>
          <button class="secondary" style="padding:2px 6px;" data-action="minus">-</button>
          <span style="margin:0 4px;">${entry.qty}</span>
          <button class="secondary" style="padding:2px 6px;" data-action="plus">+</button>
        </td>
        <td>${formatEuro(lineTotal)}</td>
      `;

      tr.querySelector('[data-action="minus"]').addEventListener("click", () => {
        if (entry.qty > 1) entry.qty--; else delete cart[entry.item.id];
        renderCart();
      });

      tr.querySelector('[data-action="plus"]').addEventListener("click", () => {
        entry.qty++; renderCart();
      });

      tbody.appendChild(tr);
    });

    totalSpan.textContent = formatEuro(total);
  }

  function addToCart(item) {
    if (!cart[item.id]) cart[item.id] = { item, qty:0 };
    cart[item.id].qty++;
    renderCart();
  }
  function clearCart() {
    cart = {};
    renderCart();
  }
  function bookSale() {
    const entries = Object.values(cart);
    if (entries.length === 0) {
      alert("Warenkorb ist leer.");
      return;
    }

    let total = 0;
    const itemsBooked = entries.map(e => {
      const line = e.item.price * e.qty;
      total += line;
      return { name:e.item.name, price:e.item.price, qty:e.qty, total:line };
    });

    salesToday.total += total;
    if (!salesToday.entries) salesToday.entries = [];
    salesToday.entries.push({
      time: new Date().toISOString(),
      total: total,
      items: itemsBooked
    });

    saveSalesForToday(salesToday);
    clearCart();
    renderDayTotal();
    renderLog();
  }

  function exportItems() {
    if (!items || items.length === 0) {
      alert("Keine Artikel zum Exportieren.");
      return;
    }
    const data = JSON.stringify(items);
    prompt("Artikel-Daten kopieren und am anderen Ger√§t importieren:", data);
  }

  // Profil-Code Generator (f√ºr PROFILES)
  function generateProfileCode() {
    if (!items || items.length === 0) {
      alert("Keine Artikel vorhanden ‚Äì zuerst Artikel anlegen oder importieren.");
      return;
    }
    const name = prompt("Profilname (z.B. stockschiessen2, weihnachtsmarkt):");
    if (!name) return;

    let key = name.trim().toLowerCase();
    key = key.replace("√ü","ss").replace(/[^a-z0-9]/g,""); // nur a-z0-9

    if (!key) {
      alert("Ung√ºltiger Profilname.");
      return;
    }

    const snippet = `"${key}": ${JSON.stringify(items, null, 2)}`;
    prompt(
      "Diesen Code kopieren und oben im Skript bei PROFILES einf√ºgen:",
      snippet
    );
  }

  function importItems() {
    const data = prompt(
      "Entweder:\n" +
      "‚Ä¢ exportierten Text einf√ºgen\n" +
      "ODER\n" +
      "‚Ä¢ Profil-Kennwort eingeben (z.B. stockschiessen)\n\n" +
      "Achtung: vorhandene Artikel werden √ºberschrieben."
    );
    if (!data) return;

    const trimmed = data.trim();
    const key = trimmed.toLowerCase();

    // Profil?
    if (PROFILES[key]) {
      items = PROFILES[key].map(it => normalizeItem({ ...it }));
      saveItems(items);
      cart = {};
      renderItems();
      renderCart();
      updateAdminUI();
      alert('Artikelprofil "' + trimmed + '" wurde geladen.');
      return;
    }

    // sonst JSON
    try {
      const imported = JSON.parse(trimmed);
      if (!Array.isArray(imported)) throw new Error("Kein Array");
      imported.forEach(it => {
        if (typeof it.name !== "string" || typeof it.price !== "number") {
          throw new Error("Ung√ºltiger Artikel");
        }
        normalizeItem(it);
      });
      items = imported.map(normalizeItem);
      saveItems(items);
      cart = {};
      renderItems();
      renderCart();
      updateAdminUI();
      alert("Artikel erfolgreich importiert.");
    } catch (e) {
      alert("Import fehlgeschlagen. Entweder Profilname falsch oder JSON ung√ºltig.");
    }
  }

  document.getElementById("addItemBtn").addEventListener("click", addNewItem);
  document.getElementById("clearCartBtn").addEventListener("click", clearCart);
  document.getElementById("bookSaleBtn").addEventListener("click", bookSale);
  document.getElementById("exportItemsBtn").addEventListener("click", exportItems);
  document.getElementById("importItemsBtn").addEventListener("click", importItems);
  document.getElementById("profileCodeBtn").addEventListener("click", generateProfileCode);

  renderDate();
  renderItems();
  renderCart();
  renderDayTotal();
  renderLog();
  updateAdminUI();
</script>
</body>
</html>
