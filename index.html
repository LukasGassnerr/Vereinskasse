<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Vereinskasse</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { box-sizing: border-box; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    body { margin:0; padding:10px; background:#f5f5f5; }
    h1 { font-size:1.4rem; text-align:center; margin-bottom:10px; }
    h2 { font-size:1.1rem; margin:12px 0 6px; }
    .card { background:white; border-radius:10px; padding:10px; margin-bottom:10px; box-shadow:0 2px 4px rgba(0,0,0,0.08); }
    label { font-size:0.85rem; display:block; margin-bottom:3px; }
    input[type="text"], input[type="number"] { width:100%; padding:8px; margin-bottom:6px; border-radius:6px; border:1px solid #ccc; font-size:1rem; }
    button { padding:8px 10px; border-radius:8px; border:none; font-size:0.9rem; cursor:pointer; margin:2px 0; }
    button.primary { background:#007bff; color:white; }
    button.secondary { background:#e0e0e0; }
    button.small { font-size:0.8rem; padding:6px 8px; }
    .button-row { display:flex; gap:6px; flex-wrap:wrap; margin-top:4px; }
    .item-list { display:flex; flex-wrap:wrap; gap:6px; max-height:260px; overflow-y:auto; }
    .item-btn { flex:1 0 calc(50% - 6px); background:#fff; border:1px solid #ddd; border-radius:10px; padding:8px; text-align:center; font-size:0.9rem; position:relative; }
    .item-name { font-weight:600; display:block; }
    .item-price { font-size:0.8rem; color:#555; }
    .edit-icon { position:absolute; top:5px; right:5px; font-size:16px; cursor:pointer; }
    .hidden { display:none !important; }
  </style>
</head>
<body>
  <h1>Vereinskasse</h1>

  <div class="card">
    <div class="summary">
      <div>Datum: <span id="dateText"></span></div>
      <div>Heutiger Tagesumsatz: <strong id="dayTotal">0,00 ‚Ç¨</strong></div>
      <div class="small">Dieses System ist nur eine Hilfe und keine gesetzliche Registrierkasse.</div>
    </div>
    <button class="secondary small" id="adminLoginBtn">üîê Admin Login</button>
    <button class="secondary small hidden" id="adminLogoutBtn">üö™ Logout</button>
  </div>

  <!-- Admin-Bereich: Artikel anlegen -->
  <div class="card admin-only hidden" id="adminPanel">
    <h2>Artikel anlegen</h2>
    <label for="itemName">Name</label>
    <input type="text" id="itemName" placeholder="z.B. Bier, Spritzer">
    <label for="itemPrice">Preis in ‚Ç¨</label>
    <input type="number" id="itemPrice" step="0.01" min="0" placeholder="z.B. 2.50">
    <button class="primary" style="width:100%;" id="addItemBtn">Artikel speichern</button>
    <div class="button-row">
      <button class="secondary small" id="exportItemsBtn">Artikel exportieren</button>
      <button class="secondary small" id="importItemsBtn">Artikel importieren</button>
    </div>
  </div>

  <!-- Artikel anzeigen -->
  <div class="card">
    <h2>Artikel ausw√§hlen</h2>
    <div class="item-list" id="itemList"></div>
    <div class="small">Tippen = in Warenkorb, ‚öôÔ∏è = bearbeiten (nur Admin).</div>
  </div>

<script>
  // ==== BASIS-FUNKTIONEN ====
  let isAdmin = false;  // wird per PIN aktiviert

  const PIN = "1111";  // HIER PIN √ÑNDERN WENN DU WILLST !!

  const STORAGE_ITEMS_KEY = "kasse_items_v1";

  function loadItems() {
    const raw = localStorage.getItem(STORAGE_ITEMS_KEY);
    return raw ? JSON.parse(raw) : [];
  }

  function saveItems(items) {
    localStorage.setItem(STORAGE_ITEMS_KEY, JSON.stringify(items));
  }

  let items = loadItems();

  // ==== ADMIN UI UPDATEN ====
  function updateAdminUI() {
    document.getElementById("adminPanel").classList.toggle("hidden", !isAdmin);
    document.getElementById("adminLogoutBtn").classList.toggle("hidden", !isAdmin);
    document.getElementById("adminLoginBtn").classList.toggle("hidden", isAdmin);
    
    // Hide edit icons if not admin
    document.querySelectorAll(".edit-icon").forEach(icon => {
      icon.style.visibility = isAdmin ? "visible" : "hidden";
    });
  }

  // ==== LOGIN / LOGOUT ====
  document.getElementById("adminLoginBtn").addEventListener("click", () => {
    const entered = prompt("Admin-PIN eingeben:");
    if (entered === PIN) {
      isAdmin = true;
      updateAdminUI();
    } else {
      alert("Falscher PIN!");
    }
  });

  document.getElementById("adminLogoutBtn").addEventListener("click", () => {
    isAdmin = false;
    updateAdminUI();
  });

  // ==== ARTIKEL-ANZEIGE ====
  function renderItems() {
    const container = document.getElementById("itemList");
    container.innerHTML = "";

    if (items.length === 0) {
      container.innerHTML = '<div class="small">Keine Artikel gespeichert.</div>';
      return;
    }

    items.forEach(item => {
      const div = document.createElement("div");
      div.className = "item-btn";
      div.innerHTML = `
        <span class="item-name">${item.name}</span>
        <span class="item-price">${item.price.toFixed(2)} ‚Ç¨</span>
        <span class="edit-icon" style="visibility:${isAdmin ? 'visible' : 'hidden'};">‚öôÔ∏è</span>
      `;
      div.addEventListener("click", (e) => {
        if (e.target.classList.contains("edit-icon") && isAdmin) {
          editItem(item);
        } else {
          addToCart(item);
        }
      });
      container.appendChild(div);
    });
  }

  // ==== ADMIN FUNKTIONEN ====
  function addItem() {
    const name = document.getElementById("itemName").value.trim();
    const price = parseFloat(document.getElementById("itemPrice").value);

    if (!name || isNaN(price)) return alert("Name und Preis eingeben!");
    items.push({ id: Date.now(), name, price });
    saveItems(items);
    renderItems();
  }

  function editItem(item) {
    const newName = prompt("Neuer Name (leer lassen zum L√∂schen):", item.name);
    if (newName === null) return;

    if (newName.trim() === "") {
      // l√∂schen
      items = items.filter(i => i.id !== item.id);
    } else {
      const newPrice = prompt("Neuer Preis (‚Ç¨):", item.price);
      const priceValue = parseFloat(newPrice.replace(",", "."));
      if (isNaN(priceValue)) return alert("Ung√ºltiger Preis!");
      item.name = newName.trim();
      item.price = priceValue;
    }
    saveItems(items);
    renderItems();
  }

  // ==== CART ====
  let cart = {};
  function addToCart(item) {
    if (!cart[item.id]) cart[item.id] = { item, qty:0 };
    cart[item.id].qty++;
    renderCart();
  }

  function renderCart() {
    // Simplified ‚Üí nur zum Testen
    console.log(cart);
  }

  // ==== EXPORT / IMPORT ====
  document.getElementById("exportItemsBtn")?.addEventListener("click", () => {
    const data = JSON.stringify(items);
    prompt("Artikel kopieren:", data);
  });

  document.getElementById("importItemsBtn")?.addEventListener("click", () => {
    const data = prompt("Exportierten Text einf√ºgen:");
    try {
      items = JSON.parse(data);
      saveItems(items);
      renderItems();
    } catch {
      alert("Fehler beim Import!");
    }
  });

  document.getElementById("addItemBtn")?.addEventListener("click", addItem);

  renderItems();
  updateAdminUI();
</script>
</body>
</html>
